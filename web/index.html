<!-- web/index.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Rail Crack Detection</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9fafb;
      color: #333;
    }
    h2 { color: #222; }
    label { font-size: 18px; }
    input {
      font-size: 16px;
      padding: 5px 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    button {
      font-size: 16px;
      padding: 6px 12px;
      border-radius: 5px;
      border: none;
      background: #0078d7;
      color: white;
      cursor: pointer;
    }
    button:hover { background: #005fa3; }
    .status {
      font-size: 20px;
      margin-top: 20px;
      padding: 12px;
      border-radius: 8px;
      display: inline-block;
    }
    .green  { background: #dff0d8; color: #216b21; }
    .yellow { background: #fff3cd; color: #7a5900; }
    .red    { background: #f8d7da; color: #721c24; }
    select {
      font-size: 16px;
      padding: 4px 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
  </style>
</head>

<body>
  <h2>Rail Crack Detection</h2>

  <label>Model:
    <select id="model">
      <!-- <option value="predict">Random Forest (Amplitudeâ€“Frequency)</option> -->
      <option value="predict_fft">CNN (FFT-based)</option>
    </select>
  </label>
  <br/><br/>

  <label>Frequency (Hz): <input id="freq" value="5000" /></label><br/><br/>
  <label>Amplitude: <input id="amp" value="700" /></label><br/><br/>

  <button id="send">Predict</button>

  <div id="out" style="margin-top:25px"></div>

  <script>
  document.getElementById('send').onclick = async () => {
    const freq = parseFloat(document.getElementById('freq').value);
    const amp  = parseFloat(document.getElementById('amp').value);
    const model = document.getElementById('model').value;

    // call FastAPI backend (Random Forest or CNN based on dropdown)
    const res = await fetch(`http://127.0.0.1:8000/${model}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ frequency: freq, amplitude: amp })
    });

    const j = await res.json();
    const out = document.getElementById('out');

    // choose color and text styling
    let colorClass = 'green';
    if (j.label === 'minor') colorClass = 'yellow';
    if (j.label === 'major') colorClass = 'red';

    // format probabilities (rounded to 2 decimals)
    const probs = j.probabilities
      ? Object.entries(j.probabilities)
          .map(([k, v]) => `${k}: ${(v * 100).toFixed(1)}%`)
          .join(' | ')
      : 'No probabilities available';

    // render output
    out.innerHTML = `
      <div class="status ${colorClass}">
        <b>Model:</b> ${model === 'predict' ? 'Random Forest' : 'CNN (FFT)'}<br/>
        <b>Prediction:</b> ${j.label.toUpperCase()}<br/>
        <b>Probabilities:</b> ${probs}
      </div>`;
  };
  </script>
</body>
</html>
